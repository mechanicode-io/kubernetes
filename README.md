# Kubernetes

This repository contains two applications, one written in Go and the other in Python, along with Kubernetes manifests for deploying them. Additionally, it includes instructions for setting up a local Kubernetes environment using Docker Desktop and deploying the applications via manifests or helm.

This is a WIP that we should all contribute to.

This repo will serve as the primary SOT of how we leverage, deploy and upkeep our kubernetes ecosystems- right now it serves as a basic tutorial to be able to get some apps working and to be able to mess with each part of the SDLC from source to deployment, CICD, etc.

## Tools
### Files:
- **populate-helm.sh**: A psuedo sh to populate an existing manifest into a helm chart- there are existing tools out there that do it too but this gives you an idea of what's happening. This script scraped what was in an existing working manifest and converted it into templates for a helm chart.

## Go Deployment

### Files:
- **Dockerfile**: Instructions for building a Docker image of the Go application.
- **Tiltfile**: Configuration file for Tilt, a local development environment tool.
- **manifest.yaml**: Kubernetes manifest file for deploying the Go application.
- **config/**: Configuration directory for the Go application.
- **static/**: Directory containing static assets used by the Go application.
  - **img/**: Images and icons used by the Go application.
    - *icon-github.svg*: SVG icon for GitHub.
    - *logo.png*: Logo image for the application.
- **templates/**: Directory containing HTML templates used by the Go application.
  - *index.html*: Main HTML template for the application.

### Helm Chart (Deployment and Repository Setup):
- **azinterview-go/**:
  - **Chart.yaml**: Helm chart metadata file for packaging and deploying the Go application.
  - **templates/**: Directory containing Kubernetes manifest templates used by the Helm chart.
    - **deployment.yaml**: Kubernetes Deployment resource template for deploying the Go application.
    - **ingress.yaml**: Ingress resource template for exposing the Go application to the outside world.
    - **service.yaml**: Service resource template for defining networking rules for accessing the Go application.
  - **values.yaml**: Values file containing configuration settings and parameters for the Helm chart.

## Python Deployment

### Files:
- **Dockerfile**: Instructions for building a Docker image of the Python application.
- **pyproject.toml**: Project metadata and dependencies for the Python application.
- **poetry.lock**: Lock file generated by Poetry, a Python dependency management tool.
- **main.py**: Main Python script for the application.
- **config/**: Configuration directory for the Python application.
- **static/**: Directory containing static assets used by the Python application.
  - **img/**: Images and icons used by the Python application.
    - *icon-github.svg*: SVG icon for GitHub.
    - *logo.png*: Logo image for the application.
- **templates/**: Directory containing Jinja2 HTML templates used by the Python application.
  - *index.j2.html*: Main HTML template for the application.

### Helm Chart (Deployment and Repository Setup):
- The Python application can leverage the same Helm chart files provided for the Go application to create its own Helm repository and deploy on Kubernetes.

## Setting up Local Kubernetes Environment with Docker Desktop

### Prerequisites:
- Docker Desktop (for Mac and Windows)
- Ingress controller (for simplicity using) NGINX-INGRESS - https://kubernetes.github.io/ingress-nginx/deploy/
- Cert-Manager for those wanting to terminate SSL with an ingress - https://cert-manager.io/docs/installation/
- All kubectl tools you can find- kubectl, kubectx, kubectl konfig, k9s, etc

### For the adventurous
- Install and use Kong - https://docs.konghq.com/gateway/latest/install/kubernetes/
- Dashboard - https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/
- API Gateway instead of an ingress using Kong - https://konghq.com/blog/engineering/how-to-manage-your-kubernetes-services-with-an-api-gateway

### Steps:
1. Install Docker Desktop from the official website.
2. Enable Kubernetes in Docker Desktop settings.
3. Wait for Docker Desktop to set up the local Kubernetes cluster.
4. Verify Kubernetes cluster status by running `kubectl cluster-info` in the terminal.

## Tutorial: Deploying Applications in a Local Kubernetes Environment

### Go Application Deployment:
1. Build the Docker image of the Go application using the provided Dockerfile.
2. Deploy the application on the local Kubernetes cluster using the provided manifest.yaml file.
3. Monitor the deployment status using `kubectl get pods` and troubleshoot any issues encountered.

### Python Application Deployment:
1. Build the Docker image of the Python application using the provided Dockerfile.
2. Create a helm deployment and put it in a repo.
3. Deploy the application on the local Kubernetes cluster the created repo.
4. Connect to the pod and make sure it works.

## Helm Repository Setup and Usage

### Create local Helm repository
1. Set Up a Directory Structure
2. Choose a directory where you want to store your Helm charts. Inside this directory, create a subdirectory for your charts.

3. Initialize the Repository
4. Run the following command to initialize the repository:
```bash
helm repo index <path_to_chart_directory>
```

5. Serve the Repository
You need a web server to serve the Helm repository. Use Python's built-in HTTP server:
```bash
cd <path_to_chart_directory>
python3 -m http.server 8080
```
6. Add the Repository to Helm
Once your local repository is served, add it to Helm's list of repositories:
```bash
helm repo add <repository_name> http://localhost:8080
```

7. Verify the Repository
You can verify that Helm has added your repository correctly by running:
```bash
helm repo list
```

### Pushing Go Application to Local Helm Repository:
1. Build the Helm chart package for the Go application using the provided Helm chart files.
2. Create a local Helm repository using `helm repo add <repository_name> <repository_url>`.
3. Push the Helm chart package to the local Helm repository using `helm push <chart_package> <repository_name>`.

### Creating Helm Chart for Python Application:
1. Create a new Helm chart directory structure for the Python application.
2. Define the required Kubernetes resources (Deployment, Service, Ingress) in the Helm chart templates.
3. Customize the Helm chart values.yaml file to configure the Python application settings.
```
Hint: use the go apps manifest to populate the templates.
```
### Adding Python Application to Local Helm Repository:
1. Package the Helm chart for the Python application using `helm package <chart_directory>`.
2. Push the Helm chart package to the local Helm repository using `helm push <chart_package> <repository_name>`.

### Deploying Applications using Helm:
1. Install the desired application Helm chart from the local Helm repository using `helm install <chart_name> <repository_name>/<chart_name>`.
2. Monitor the deployment status using `helm list` and `kubectl get pods`.
3. Access the deployed application using the provided service endpoints or ingress URLs.

## License

This project is licensed under the [MIT License](LICENSE).
